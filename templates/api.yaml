# This is a templatized verion of a CFo template for Amazon API Gateway with
# Lambda backends as the handlers.  This template forms the core of every
# Panda Sky app deployment, with mixins adding resources to the description.
#===============================================================================

# Specify the API Gateway
API:
  Type: "AWS::ApiGateway::RestApi"
  Properties:
    Name: {{gatewayName}}
    Description: {{description}}

{{> iamrole rolename="LambdaRole"}}

# The Root Resource needs different expansion than others.
{{#with rootResource}}
# Define the OPTIONS handler
{{> options}}
{{#each methods}}
{{> method resource=.. }}
{{/each}} # methods
{{/with}}

{{#each skyResources}}
# Define the API Gateway Resource
{{> resource}}
# Define the OPTIONS method
{{> options}}
{{#each methods}}
{{> method resource=.. }}
{{/each}} # methods
{{/each}} # skyResources

{{#each schema}}
{{> model }}
{{/each}}

{{> deployment deployment="Deployment"}}

# Specify CloudFront Distribution, if required.
{{#if aws.cloudfront}}
{{> cloudfront distro="CFRDistro"}}
{{/if}}

{{#if aws.route53}}
{{> route53 distro="CFRDistro"}}
{{/if}}
