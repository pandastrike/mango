# This is a templatized verion of a CFo template for Amazon API Gateway with
# Lambda backends as the handlers.  This template forms the core of every
# Panda Sky app deployment, with mixins adding resources to the description.
#===============================================================================

# Specify the API Gateway
API:
  Type: "AWS::ApiGateway::RestApi"
  Properties:
    Name: {{gatewayName}}
    Description: {{description}}

{{> iamrole rolename="LambdaRole"}}

{{#each apiResources}}

{{#unless rootResource}}
{{> resource}}
{{/unless}}

{{> options}}

{{#each methods}}
{{> method gatewayResourceName=../gatewayResourceName rootResource=../rootResource}}
{{/each}} # methods
{{/each}} # apiResources

{{#each schema}}
{{> model }}
{{/each}}

{{> deployment deployment="Deployment"}}

# Specify CloudFront Distribution, if required.
{{#if aws.cloudfront}}
{{> cloudfront distro="CFRDistro"}}
{{/if}}

{{#if aws.route53}}
{{> route53 distro="CFRDistro"}}
{{/if}}
